# Markdown Index 项目任务清单

## 项目概述

本项目旨在实现一个符合Raycast脚本规范的shell脚本，用于为Markdown文档的标题自动添加序号。参考了[markdown_index](https://github.com/legendmohe/markdown_index)项目的实现。

## 功能需求

- [ ] 为markdown标题自动添加序号
- [ ] 支持多级标题的序号层级管理
- [ ] 支持代码块内容的保护（不处理代码块内的#符号）
- [ ] 支持重复运行自动更新序号
- [ ] 只处理用户选中的内容部分

## 技术约束

- [ ] 脚本运行在macOS环境
- [ ] 脚本符合Raycast脚本规范
- [ ] 脚本形态为.sh文件
- [ ] 通过剪贴板获取和处理选中内容

## 开发任务

### 1. 需求分析与设计 ✅

- [x] 分析参考项目[markdown_index](https://github.com/legendmohe/markdown_index)的实现方式
- [x] 确定序号格式规范（如：1. 1.1. 1.1.1.）
- [x] 确定处理逻辑细节
- [x] 设计脚本整体架构

### 2. 核心功能实现 ✅

- [x] 实现获取剪贴板内容的功能
- [x] 实现Markdown标题识别功能
- [x] 实现代码块识别与保护功能
- [x] 实现序号生成与添加功能
- [x] 实现结果写回剪贴板功能

### 3. Raycast集成 ✅

- [x] 研究Raycast脚本规范
- [x] 添加必要的脚本元数据
- [x] 实现与Raycast的交互逻辑

### 4. 测试与优化 ✅

- [x] 编写测试用例
- [x] 进行功能测试
- [x] 处理边缘情况
- [x] 性能优化

### 5. 文档完善 ✅

- [x] 完善README.md
- [x] 添加使用示例
- [x] 添加安装说明

## 项目状态

🎉 **项目已完成！** 所有核心功能和文档都已实现并通过测试。

### 已交付内容

1. **核心脚本**: `markdown-index.sh` - 完全功能的Raycast脚本
2. **测试套件**: `test/test-runner.sh` - 自动化测试脚本
3. **测试用例**: `test/test-cases.md` - 详细的测试场景
4. **架构文档**: `architecture.md` - 技术架构说明
5. **安装指南**: `docs/installation.md` - 详细安装步骤
6. **使用说明**: `docs/usage.md` - 完整使用指南

### 功能验证

✅ 基础多级标题处理  
✅ 代码块保护机制  
✅ 重复运行序号更新  
✅ 空内容错误处理  
✅ 无标题内容错误处理  

### 下一步建议

- 在实际使用中收集用户反馈
- 根据需要添加新功能（如自定义序号格式）
- 考虑支持其他编辑器集成
- 定期维护和更新文档

## 实现思路

### 序号格式规范

- 采用 `1.` `1.1.` `1.1.1.` 的格式
- 根据标题级别（#、##、###）自动生成对应的序号层级
- 支持重复运行命令自动更新序号

### 处理逻辑

1. 获取用户选中的文本（通过剪贴板）
2. 解析文本，识别Markdown标题和代码块
3. 跳过代码块内容，只处理正常文本中的标题
4. 为标题添加或更新序号
5. 将处理后的内容写回剪贴板
6. 通知用户处理完成

### 示例转换

**原始内容：**
```markdown
# a
## a-b  
## a-c
### a-c-d
## a-e
# f
```

**处理后：**
```markdown
# 1. a
## 1.1. a-b
## 1.2. a-c  
### 1.2.1. a-c-d
## 1.3. a-e
# 2. f
```